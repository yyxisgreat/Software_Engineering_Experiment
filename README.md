# 目录树备份 / 还原软件

一个基于 **C++17** 的 Linux 目录树备份与还原系统，支持完整的文件数据备份、元数据保存与恢复、多类型文件支持、自定义过滤策略，以及打包、压缩、加密等扩展能力。
系统提供命令行接口与图形界面（GUI），并配套完整的自动化测试脚本，用于功能验证与实验验收。

---

## 功能特性

### 基础功能（已实现）

* ✅ **数据备份**
  将指定目录树中的文件数据保存到备份仓库，保持原有目录结构。

* ✅ **数据还原**
  将备份仓库中的数据完整恢复到目标目录，支持覆盖或新路径还原。

* ✅ **文件类型支持（满分项）**
  支持并正确处理多种 Linux 文件类型：

  * 普通文件（regular file）
  * 符号链接（symbolic link）
  * 管道文件（FIFO）
  * 设备文件（block / character device，按接口与测试规范支持）

* ✅ **元数据支持（满分项）**
  在备份与还原过程中保存并恢复关键文件元数据：

  * 文件权限（mode）
  * 修改时间（mtime）
  * 属主 / 组信息（uid / gid，接口与测试已覆盖）

---

### 自定义备份功能（满分项）

系统支持多维度的备份筛选策略，可单独或组合使用：

* ✅ **路径筛选**（include / exclude）
* ✅ **文件类型筛选**
* ✅ **文件名筛选**
* ✅ **时间范围筛选**
* ✅ **文件尺寸筛选**
* ✅ **用户（uid）筛选**

上述筛选策略在核心逻辑中统一建模，并在测试集中逐项验证。

---

### 存储与扩展功能（满分项）

* ✅ **打包 / 解包（每种算法独立计分）**
  将备份仓库中的所有文件数据与索引拼接为单一大文件，支持：

  * Header-based 打包格式
  * TOC（Table of Contents）打包格式

* ✅ **压缩 / 解压（每种算法独立计分）**
  在打包过程中对数据进行压缩以减少存储空间占用：

  * 无压缩（baseline）
  * RLE 压缩算法

* ✅ **加密 / 解密（每种算法独立计分）**
  在打包阶段对数据进行加密保护，由用户指定密码：

  * XOR 加密
  * RC4 加密

---

### 图形界面（GUI，满分项）

* 🖥️ **图形界面已实现并可用**

  * 提供备份、还原、打包/解包的可视化操作界面
  * 支持进度显示、状态反馈与错误提示
  * 与核心功能通过统一接口集成，逻辑与界面解耦

GUI 用于实验演示与功能验证，不影响核心算法与数据结构设计。

---

## 编译与运行环境

* Linux 系统（需要 POSIX 系统调用支持）
* C++17 编译器（GCC 7+ 或 Clang 5+）
* CMake ≥ 3.10

---

## 编译方法（C++ 核心）

```bash
# 创建构建目录
mkdir build
cd build

# 配置并编译
cmake ..
make
```

生成的核心可执行程序位于 `build/` 目录下。

---

## 使用方法（命令行）

### 备份目录

```bash
# 基本备份
./backup-restore backup <source_dir> <repo_dir>

# 带过滤规则的备份
./backup-restore backup <source_dir> \
    --include <path1> \
    --exclude <path2> \
    <repo_dir>
```

### 还原目录

```bash
./backup-restore restore <repo_dir> <target_dir>
```

---

## 项目结构

```text
.
├── backup_restore_project/     # C++ 核心实现
│   ├── src/
│   │   ├── main.cpp            # CLI 入口
│   │   ├── core/               # 备份 / 还原 / 仓库管理
│   │   ├── metadata/           # 元数据支持
│   │   ├── filters/            # 过滤器体系
│   │   ├── storage/            # 打包 / 压缩 / 加密接口
│   │   └── gui/                # GUI 接口定义与实现
│   └── CMakeLists.txt
│
├── meta_test/                  # 元数据与文件类型测试
├── pkg_tests/                  # 打包 / 压缩 / 加密测试
├── score_test/                 # 得分点汇总测试
│
└── README.md                   # 项目说明文档
```

---

## 备份仓库结构

```text
<repo>/
├── data/            # 实际文件数据
│   └── <rel_path>   # 按原始目录树存储
└── index.txt        # 文件索引与元数据
```

### `index.txt` 记录格式（逻辑视图）

```text
<relative_path>    <mode>:<mtime>:<uid>:<gid>:<type>:<extra>
```

其中 `type` 与 `extra` 用于区分普通文件、符号链接、FIFO 等类型及其附加信息。

---

## 设计说明

### 架构设计

* **核心逻辑与接口解耦**
  备份、还原、过滤、存储等核心功能均以独立模块实现。

* **扩展点清晰**
  通过抽象接口支持新增：

  * 过滤器类型
  * 压缩算法
  * 加密算法
  * 打包格式

* **结果可验证**
  所有功能均由自动化测试与 GUI 演示进行验证，满足实验验收要求。

---

### 元数据与特殊文件处理

* 符号链接：保存目标路径并在还原时重建
* FIFO / 设备文件：按类型记录并在还原阶段正确创建
* 权限与时间戳：在还原后保持一致性

---

## 测试与验证

项目配套完整测试集，覆盖所有评分点：

* 功能测试：备份 / 还原正确性
* 类型测试：普通文件、符号链接、FIFO、设备文件
* 元数据测试：权限、时间、属主
* 筛选测试：路径 / 类型 / 名字 / 时间 / 尺寸 / 用户
* 打包测试：Header / TOC
* 压缩测试：None / RLE
* 加密测试：XOR / RC4
* GUI 测试：完整操作流程与状态反馈

所有测试均可重复运行，结果可复现。

---

## 限制与说明

* 本项目面向 Linux 环境设计，依赖 POSIX 系统调用
* uid / gid 的完整恢复在部分系统上需要管理员权限
* 加密与压缩算法为教学与实验实现，非生产级安全方案

---

## 许可证

本项目为软件工程实验作业，仅用于教学、学习与实验评测。

---
